# ä¹¦é¡µé˜… - æ•°æ®åº“è®¾è®¡

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†"ä¹¦é¡µé˜…"å¾®ä¿¡å°ç¨‹åºPDFé˜…è¯»å™¨çš„äº‘å¼€å‘æ•°æ®åº“è®¾è®¡ã€‚

## æ•°æ®è¡¨ç»“æ„

### 1. `categories` - æ ç›®è¡¨

ç”¨äºå­˜å‚¨PDFçš„åˆ†ç±»æ ç›®ä¿¡æ¯ã€‚

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| _id | string | æ˜¯ | è‡ªåŠ¨ç”Ÿæˆï¼Œå”¯ä¸€æ ‡è¯† |
| name | string | æ˜¯ | æ ç›®åç§°ï¼Œå¦‚"å°è¯´"ã€"ç§‘æŠ€" |
| sort | number | æ˜¯ | æ’åºæƒé‡ï¼Œæ•°å­—è¶Šå°è¶Šé å‰ |
| createTime | date | æ˜¯ | åˆ›å»ºæ—¶é—´ |

**ç¤ºä¾‹æ•°æ®ï¼š**
```json
{
  "_id": "xxx123",
  "name": "æ–‡å­¦ç»å…¸",
  "sort": 1,
  "createTime": "2024-01-01T00:00:00.000Z"
}
```

### 2. `pdfs` - PDFèµ„æ–™è¡¨

å­˜å‚¨PDFç”µå­ä¹¦çš„åŸºæœ¬ä¿¡æ¯å’Œå›¾ç‰‡åˆ—è¡¨ã€‚

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| _id | string | æ˜¯ | è‡ªåŠ¨ç”Ÿæˆï¼Œå”¯ä¸€æ ‡è¯† |
| title | string | æ˜¯ | PDFæ ‡é¢˜ |
| author | string | æ˜¯ | ä½œè€…/æ¥æº |
| cover | string | æ˜¯ | å°é¢å›¾URLï¼ˆäº‘å­˜å‚¨ï¼‰ |
| description | string | å¦ | ç®€ä»‹/æ‘˜è¦ |
| pages | number | æ˜¯ | æ€»é¡µæ•° |
| images | array | æ˜¯ | æ¯ä¸€é¡µçš„å›¾ç‰‡URLæ•°ç»„ï¼ˆæŒ‰é¡ºåºå­˜å‚¨ï¼‰ |
| categoryId | string | æ˜¯ | æ‰€å±æ ç›®ID |
| viewCount | number | æ˜¯ | é˜…è¯»æ¬¡æ•°ï¼Œé»˜è®¤ä¸º0 |
| likeCount | number | æ˜¯ | æ”¶è—/ç‚¹èµæ•°ï¼Œé»˜è®¤ä¸º0 |
| status | boolean | æ˜¯ | ä¸Šæ¶çŠ¶æ€ï¼Œtrueä¸ºå·²ä¸Šæ¶ |
| createTime | date | æ˜¯ | åˆ›å»ºæ—¶é—´ |

**ç¤ºä¾‹æ•°æ®ï¼š**
```json
{
  "_id": "pdf001",
  "title": "çº¢æ¥¼æ¢¦",
  "author": "æ›¹é›ªèŠ¹",
  "cover": "cloud://xxx/cover/1.jpg",
  "description": "ä¸­å›½å¤å…¸å››å¤§åè‘—ä¹‹ä¸€",
  "pages": 120,
  "images": [
    "cloud://xxx/pages/1.jpg",
    "cloud://xxx/pages/2.jpg",
    "cloud://xxx/pages/3.jpg"
  ],
  "categoryId": "cat001",
  "viewCount": 100,
  "likeCount": 50,
  "status": true,
  "createTime": "2024-01-01T00:00:00.000Z"
}
```

### 3. `users` - ç”¨æˆ·è¡¨

å­˜å‚¨ç”¨æˆ·ä¿¡æ¯å’Œé˜…è¯»æ•°æ®ã€‚

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| _id | string | æ˜¯ | è‡ªåŠ¨ç”Ÿæˆ |
| _openid | string | æ˜¯ | å¾®ä¿¡openidï¼Œç”¨æˆ·å”¯ä¸€æ ‡è¯† |
| avatarUrl | string | å¦ | ç”¨æˆ·å¤´åƒURL |
| nickName | string | å¦ | ç”¨æˆ·æ˜µç§° |
| favorites | array | æ˜¯ | æ”¶è—çš„PDF IDåˆ—è¡¨ï¼Œé»˜è®¤ä¸ºç©ºæ•°ç»„ |
| readingHistory | array | æ˜¯ | é˜…è¯»å†å²è®°å½• |
| subscribedThemes | array | æ˜¯ | è®¢é˜…çš„ä¸»é¢˜IDåˆ—è¡¨ï¼Œé»˜è®¤ä¸ºç©ºæ•°ç»„ |
| updateTime | date | æ˜¯ | æ›´æ–°æ—¶é—´ |
| createTime | date | æ˜¯ | åˆ›å»ºæ—¶é—´ |

**readingHistory æ•°ç»„å…ƒç´ ç»“æ„ï¼š**
```json
{
  "pdfId": "pdf001",
  "page": 10,
  "updateTime": "2024-01-15T10:30:00.000Z"
}
```

**subscribedThemes æ•°ç»„ï¼š**
ç”¨æˆ·è®¢é˜…çš„ä¸»é¢˜IDåˆ—è¡¨ï¼Œå¦‚ `["carbon", "power", "digital-gov"]`

**ç¤ºä¾‹æ•°æ®ï¼š**
```json
{
  "_id": "user001",
  "_openid": "oXXXX...",
  "avatarUrl": "cloud://xxx/avatar.jpg",
  "nickName": "ä¹¦è™«",
  "favorites": ["pdf001", "pdf002"],
  "readingHistory": [
    {
      "pdfId": "pdf001",
      "page": 25,
      "updateTime": "2024-01-15T10:30:00.000Z"
    }
  ],
  "subscribedThemes": ["carbon", "power"],
  "updateTime": "2024-01-15T10:30:00.000Z",
  "createTime": "2024-01-01T00:00:00.000Z"
}
```

### 4. `subscription_logs` - ä¸»é¢˜è®¢é˜…æ—¥å¿—è¡¨

è®°å½•ç”¨æˆ·çš„ä¸»é¢˜è®¢é˜…è¡Œä¸ºï¼Œç”¨äºæ•°æ®åˆ†æå’Œè¿è¥ã€‚

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| _id | string | æ˜¯ | è‡ªåŠ¨ç”Ÿæˆ |
| userId | string | æ˜¯ | ç”¨æˆ·IDï¼ˆusersè¡¨_idï¼‰ |
| openId | string | æ˜¯ | å¾®ä¿¡openid |
| themeId | string | æ˜¯ | è®¢é˜…çš„ä¸»é¢˜ID |
| subscribeTime | date | æ˜¯ | è®¢é˜…æ—¶é—´ |
| createTime | date | æ˜¯ | è®°å½•åˆ›å»ºæ—¶é—´ |

**ç¤ºä¾‹æ•°æ®ï¼š**
```json
{
  "_id": "sub001",
  "userId": "user001",
  "openId": "oXXXX...",
  "themeId": "carbon",
  "subscribeTime": "2024-01-15T10:30:00.000Z",
  "createTime": "2024-01-15T10:30:00.000Z"
}
```

### 5. `themes` - ä¸»é¢˜é…ç½®è¡¨ï¼ˆå¯é€‰ï¼‰

å­˜å‚¨ä¸»é¢˜çš„åŸºæœ¬é…ç½®ä¿¡æ¯ï¼Œç”¨äºåå°ç®¡ç†ã€‚

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| _id | string | æ˜¯ | è‡ªåŠ¨ç”Ÿæˆ |
| themeId | string | æ˜¯ | ä¸»é¢˜å”¯ä¸€æ ‡è¯†ï¼ˆå¦‚ carbon, powerï¼‰ |
| name | string | æ˜¯ | ä¸»é¢˜åç§° |
| shortName | string | æ˜¯ | ç®€ç§° |
| color | string | æ˜¯ | ä¸»é¢˜è‰²ï¼ˆå¦‚ #10B981ï¼‰ |
| lightColor | string | æ˜¯ | æµ…è‰²èƒŒæ™¯è‰² |
| icon | string | æ˜¯ | å›¾æ ‡URLæˆ–emoji |
| tags | array | æ˜¯ | ä¸»é¢˜æ ‡ç­¾ |
| description | string | æ˜¯ | ä¸»é¢˜æè¿° |
| sort | number | æ˜¯ | æ’åºæƒé‡ |
| status | boolean | æ˜¯ | æ˜¯å¦å¯ç”¨ |
| createTime | date | æ˜¯ | åˆ›å»ºæ—¶é—´ |

**ç¤ºä¾‹æ•°æ®ï¼š**
```json
{
  "_id": "theme001",
  "themeId": "carbon",
  "name": "ç¢³ä¸­å’Œ",
  "shortName": "ç¢³ä¸­å’Œ",
  "color": "#10B981",
  "lightColor": "rgba(16, 185, 129, 0.15)",
  "icon": "ğŸŒ¿",
  "tags": ["ç»¿è‰²å‘å±•", "ç¯ä¿é¢†åŸŸ"],
  "description": "åŒç¢³ç›®æ ‡æ”¿ç­–è§£è¯»ä¸ä¼ä¸šç¢³ä¸­å’Œå®æ–½è·¯å¾„",
  "sort": 1,
  "status": true,
  "createTime": "2024-01-01T00:00:00.000Z"
}
```

## æ•°æ®åº“æƒé™é…ç½®

### categoriesï¼ˆæ ç›®è¡¨ï¼‰
- è¯»å–ï¼šæ‰€æœ‰ç”¨æˆ·å¯è¯»
- å†™å…¥ï¼šä»…ç®¡ç†å‘˜ï¼ˆå¯é…ç½®äº‘å‡½æ•°è°ƒç”¨ï¼‰

### pdfsï¼ˆPDFèµ„æ–™è¡¨ï¼‰
- è¯»å–ï¼šæ‰€æœ‰ç”¨æˆ·å¯è¯»
- å†™å…¥ï¼šä»…ç®¡ç†å‘˜ï¼ˆé€šè¿‡äº‘å‡½æ•° uploadPDFï¼‰

### usersï¼ˆç”¨æˆ·è¡¨ï¼‰
- è¯»å–ï¼šä»…ç”¨æˆ·æœ¬äºº
- å†™å…¥ï¼šä»…ç”¨æˆ·æœ¬äººï¼ˆé€šè¿‡äº‘å‡½æ•°ï¼‰

**äº‘æ•°æ®åº“å®‰å…¨è§„åˆ™ç¤ºä¾‹ï¼š**
```json
{
  "categories": {
    "read": true,
    "write": "auth.uid != null"
  },
  "pdfs": {
    "read": true,
    "write": "auth.uid != null"
  },
  "users": {
    "read": "doc._openid == auth.openid",
    "write": "doc._openid == auth.openid"
  }
}
```

## ç´¢å¼•å»ºè®®

å»ºè®®ä¸ºä»¥ä¸‹å­—æ®µåˆ›å»ºç´¢å¼•ä»¥æå‡æŸ¥è¯¢æ€§èƒ½ï¼š

1. `categories` è¡¨ï¼š`sort` å­—æ®µï¼ˆå‡åºï¼‰
2. `pdfs` è¡¨ï¼š`categoryId` + `createTime`ï¼ˆå¤åˆç´¢å¼•ï¼‰
3. `pdfs` è¡¨ï¼š`title` + `author`ï¼ˆå…¨æ–‡æœç´¢ï¼‰
4. `users` è¡¨ï¼š`_openid`ï¼ˆå”¯ä¸€ç´¢å¼•ï¼Œé»˜è®¤ï¼‰

## æ³¨æ„äº‹é¡¹

1. **images æ•°ç»„**ï¼šç”±äºå°ç¨‹åºweb-viewåŠ è½½H5çš„é™åˆ¶ï¼Œå›¾ç‰‡å»ºè®®å­˜æ”¾åœ¨äº‘å­˜å‚¨ä¸­ï¼Œå¹¶ä½¿ç”¨äº‘å­˜å‚¨çš„ä¸´æ—¶é“¾æ¥æˆ–æ°¸ä¹…é“¾æ¥ã€‚

2. **å›¾ç‰‡åŠ è½½ä¼˜åŒ–**ï¼šPDFè½¬æˆçš„å›¾ç‰‡å»ºè®®ï¼š
   - å°ºå¯¸ï¼šå®½åº¦750pxï¼ˆé€‚é…æ‰‹æœºå±å¹•ï¼‰
   - æ ¼å¼ï¼šJPEG
   - è´¨é‡ï¼š80%
   - å‘½åï¼šæŒ‰é¡µç é¡ºåºå‘½åï¼ˆ1.jpg, 2.jpg, ...ï¼‰

3. **æ•°æ®é‡è€ƒè™‘**ï¼š
   - å»ºè®®å•æœ¬PDFä¸è¶…è¿‡500é¡µ
   - å¤§å‹PDFå¯è€ƒè™‘åˆ†ç« èŠ‚å­˜å‚¨

## åˆå§‹åŒ–æ•°æ®

### æ ç›®æ•°æ®åˆå§‹åŒ–
```javascript
// åœ¨äº‘æ§åˆ¶å°æˆ–äº‘å‡½æ•°ä¸­æ·»åŠ åˆå§‹æ ç›®
db.collection('categories').add({
  data: [
    { name: 'æ–‡å­¦ç»å…¸', sort: 1 },
    { name: 'å°è¯´ä¼ è®°', sort: 2 },
    { name: 'ç§‘å­¦æŠ€æœ¯', sort: 3 },
    { name: 'å†å²åœ°ç†', sort: 4 },
    { name: 'ç»æµç®¡ç†', sort: 5 },
    { name: 'äººæ–‡ç¤¾ç§‘', sort: 6 }
  ]
});
```
