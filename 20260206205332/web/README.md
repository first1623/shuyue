# 微信公众号发布系统 - Web前端

## 系统简介

这是一个基于 Flask 的 Web 界面，提供微信公众号内容生成与发布功能的可视化操作界面。

## 功能特性

✅ **快速发布** - 输入主题，一键生成并发布文章
✅ **生成预览** - 先生成内容预览，确认后再发布
✅ **批量发布** - 一次处理多个主题
✅ **发布记录** - 查看历史发布记录
✅ **系统配置** - 可视化配置管理
✅ **实时状态** - 显示AI服务和微信API连接状态

## 快速开始

### 1. 安装依赖

```bash
cd c:\Users\zhaoy\CodeBuddy\20260206205332
pip install flask flask-cors
```

或者直接运行启动脚本，它会自动检查并安装依赖。

### 2. 启动Web服务器

**Windows用户：**
双击运行：`start_web_server.bat`

**手动启动：**
```bash
cd c:\Users\zhaoy\CodeBuddy\20260206205332\web
python api_server.py
```

### 3. 访问系统

服务器启动后，自动在浏览器中打开：
```
http://localhost:5000
```

如果没有自动打开，手动在浏览器中访问这个地址。

## 功能说明

### 快速发布

1. 输入文章主题（例如："如何缓解焦虑情绪"）
2. 选择是否生成配图（默认不生成）
3. 点击"立即发布"按钮
4. 系统自动：
   - 分析主题
   - 生成文章（标题+正文）
   - 审核内容
   - 发布到公众号草稿箱

### 生成预览

1. 输入文章主题
2. 点击"生成内容"按钮
3. 查看生成的文章预览（标题、作者、正文）
4. 满意后点击"确认发布"
5. 或点击"重新生成"重新创作

### 批量发布

1. 输入多个主题，用逗号、顿号或换行分隔
   ```
   如何建立积极心态
   心理健康的5个建议
   缓解焦虑的实用方法
   ```
2. 点击"批量发布"按钮
3. 查看实时进度和结果
4. 完成后显示成功/失败统计

### 发布记录

- 显示最近20条发布记录
- 显示文章标题、时间、状态、ID
- 支持刷新和清空记录
- 点击记录可查看详细信息

### 系统配置

**AI服务配置：**
- 选择AI服务提供商（DeepSeek、OpenAI等）
- 输入API Key
- 点击"测试连接"验证配置

**微信公众号配置：**
- 输入AppID和AppSecret
- 点击"测试连接"验证配置
- 配置会保存到浏览器本地存储

**图片生成配置：**
- 选择图片生成引擎
- 默认为"不生成图片"

## 技术架构

### 前端（Web界面）
- **index.html** - 主页面
- **app.js** - 前端逻辑
- 使用原生JavaScript，无需框架
- 响应式设计，支持各种屏幕尺寸

### 后端（API服务器）
- **api_server.py** - Flask Web服务器
- 路由：
  - `GET /` - 返回前端页面
  - `POST /api/test_config` - 测试配置
  - `POST /api/generate_preview` - 生成预览
  - `POST /api/quick_publish` - 快速发布
  - `POST /api/publish_preview` - 发布预览
  - `POST /api/batch_publish` - 批量发布
  - `GET /api/records` - 获取记录

### 核心系统
- **wechat_main.py** - 主系统逻辑
- **agents/** - 多智能体模块
  - planner.py - 策划智能体
  - wechat_writer.py - 写作智能体
  - designer.py - 设计智能体
  - reviewer.py - 审核智能体
  - wechat_publisher.py - 发布智能体

## 数据流程

```
用户输入主题
    ↓
前端发送API请求
    ↓
后端接收请求
    ↓
调用智能体系统
    ↓
1. 策划智能体分析主题
    ↓
2. 写作智能体生成文章
    ↓
3. 设计智能体生成配图（可选）
    ↓
4. 审核智能体检查内容
    ↓
5. 发布智能体上传到公众号
    ↓
返回发布结果
    ↓
前端显示结果
```

## 目录结构

```
web/
├── index.html          # 前端页面
├── app.js            # 前端逻辑
├── api_server.py      # Flask后端API
├── start_web_server.bat  # Windows启动脚本
└── README.md          # 使用说明
```

## 常见问题

### Q: 启动服务器后无法访问？

A: 检查：
1. 服务器是否正常启动（查看命令行输出）
2. 防火墙是否阻止了5000端口
3. 浏览器地址是否正确：http://localhost:5000

### Q: 提示Flask未安装？

A: 运行安装命令：
```bash
pip install flask flask-cors
```

### Q: API调用失败？

A:
1. 检查微信公众号配置（AppID和AppSecret）
2. 确认公众号类型是认证服务号
3. 检查IP白名单设置
4. 查看命令行窗口的错误信息

### Q: 文章发布到哪里了？

A: 默认发布到公众号的"草稿箱"，需要在公众号后台手动点击"发布"

### Q: 如何修改界面样式？

A: 编辑 `index.html` 中的 `<style>` 标签内容

### Q: 如何添加新功能？

A:
1. 前端：修改 `app.js` 添加新功能
2. 后端：在 `api_server.py` 添加新API路由
3. 调用对应的系统功能

## 安全建议

1. **不要在生产环境使用 debug=True**
   - 修改 `api_server.py` 最后一行为 `app.run(debug=False)`

2. **配置HTTPS**
   - 使用 Nginx 或 Apache 配置反向代理
   - 获取 SSL 证书启用 HTTPS

3. **访问控制**
   - 添加登录验证功能
   - 使用 API Key 或 Token 保护 API

4. **日志管理**
   - 定期清理日志文件
   - 敏感信息脱敏处理

## 性能优化

1. **异步处理**
   - 对于批量发布，使用后台任务队列（Celery）
   - 避免阻塞主线程

2. **缓存优化**
   - 缓存微信API的 access_token
   - 减少重复的API调用

3. **数据库**
   - 使用 SQLite 或 MySQL 存储发布记录
   - 替代文件存储方式

## 扩展功能建议

1. **用户认证**
   - 添加登录/注册功能
   - 支持多用户管理

2. **定时发布**
   - 设置文章定时发布时间
   - 使用任务调度（APScheduler）

3. **模板管理**
   - 保存常用的文章模板
   - 快速套用模板

4. **统计分析**
   - 文章阅读量统计
   - 发布频率分析
   - 主题热词分析

5. **图片编辑**
   - 在线图片编辑器
   - 调整图片尺寸和效果

## 开发者信息

- 前端：原生 HTML5 + JavaScript
- 后端：Python Flask
- 数据存储：JSON文件（可升级为数据库）
- AI模型：支持多种AI服务商

## 许可证

MIT License
