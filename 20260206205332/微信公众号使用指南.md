# 微信公众号发布系统使用指南

## 系统简介

本系统是基于多智能体架构的微信公众号内容生成与发布平台，支持：
- 智能策划：分析主题，制定内容策略
- 自动写作：生成高质量公众号文章
- 图片生成：为文章生成配图（可选）
- 内容审核：自动检查文章质量
- 一键发布：直接发布到微信公众号

---

## 快速开始

### 第一步：配置微信公众号 API

1. **获取 AppID 和 AppSecret**

   - 访问 [微信公众平台](https://mp.weixin.qq.com/)
   - 登录您的公众号账号
   - 进入"开发" -> "基本配置"
   - 查看或复制 AppID
   - 点击"重置"或"生成"获取 AppSecret

2. **配置到项目**

   编辑 `.env` 文件，添加以下配置：

   ```env
   # 微信公众号API配置
   WECHAT_APP_ID=your_app_id_here
   WECHAT_APP_SECRET=your_app_secret_here
   ```

### 第二步：启动系统

运行以下命令启动微信公众号发布系统：

```bash
python wechat_main.py
```

或在 Windows 上双击运行 `run_wechat.bat`

### 第三步：选择功能

启动后，系统会显示主菜单，提供以下功能：

1. **快速发布** - 输入主题，自动生成并发布
2. **生成预览** - 生成文章后手动确认再发布
3. **批量发布** - 一次处理多个主题
4. **查看记录** - 查看历史发布记录
5. **系统配置** - 查看当前配置
6. **退出程序**

---

## 详细使用说明

### 1. 快速发布模式

适合快速生成并发布文章的场景：

1. 选择菜单项 `1`
2. 输入文章主题（例如："如何高效学习Python"）
3. 系统自动执行完整流程：
   - 分析主题，制定策略
   - 生成文章标题和正文
   - （可选）生成配图
   - 内容审核
   - 发布到公众号（保存为草稿）
4. 显示发布结果

### 2. 生成预览模式

适合需要先查看内容再决定是否发布的场景：

1. 选择菜单项 `2`
2. 输入文章主题
3. 系统生成文章并显示预览
4. 查看文章标题、摘要、正文内容
5. 输入 `y` 确认发布，或 `n` 取消发布

### 3. 批量发布模式

适合一次性处理多个主题的场景：

1. 选择菜单项 `3`
2. 输入多个主题，用逗号分隔
   - 例如："Python入门, Python进阶, Python实战"
3. 系统显示将要处理的主题列表
4. 输入 `y` 确认开始批量处理
5. 系统逐个处理每个主题
6. 最后显示汇总结果

### 4. 查看发布记录

查看历史发布记录：

1. 选择菜单项 `4`
2. 显示最近的10条发布记录
3. 每条记录包含：
   - 发布时间
   - 主题
   - 标题
   - 文章ID
   - 发布状态
   - 消息

### 5. 系统配置

查看当前系统配置：

1. 选择菜单项 `5`
2. 显示以下配置信息：
   - AI 服务提供商
   - API Key
   - 模型名称
   - 微信公众号配置
   - 图片生成引擎

---

## 工作流程说明

### 多智能体协作流程

系统采用多智能体架构，每个智能体负责特定任务：

```
1. 策划智能体 (ContentPlanner)
   ↓
   - 分析主题
   - 确定目标人群
   - 制定内容策略
   - 提取关键词

2. 写作智能体 (WeChatArticleWriter)
   ↓
   - 生成标题
   - 撰写正文（HTML格式）
   - 生成摘要
   - 提取关键词

3. 设计智能体 (ImageDesigner)
   ↓
   - 生成图片提示词
   - 调用图片生成API
   - 保存生成的图片

4. 审核智能体 (ContentReviewer)
   ↓
   - 检查敏感词
   - 评估内容质量
   - 提供优化建议

5. 发布智能体 (WeChatPublisher)
   ↓
   - 上传封面图片
   - 创建文章草稿
   - 保存发布记录
```

### 内容生成特点

- **标题**：15-25字，吸引力强
- **正文**：1500-3000字，HTML格式
- **结构**：开头引入 + 正文分节 + 结尾总结
- **配图**：可选，适合封面或插图

---

## 配置说明

### AI 服务配置

系统支持多个 AI 服务提供商，在 `.env` 文件中配置：

```env
# 选择 AI 服务提供商
AI_PROVIDER=deepseek

# DeepSeek 配置（推荐）
DEEPSEEK_API_KEY=your_deepseek_api_key
DEEPSEEK_MODEL=deepseek-chat
```

支持的 AI 服务：
- **DeepSeek**：免费额度高（500万Tokens），推荐使用
- **通义千问**（阿里云）：稳定可靠
- **月之暗面**：适合中文生成
- **智谱AI**（GLM-4）：性能优秀
- **OpenAI**：需要翻墙

### 微信公众号 API 权限

确保您的公众号具有以下权限：

- 公众号必须是 **认证服务号**
- 具有以下接口权限：
  - 素材管理接口
  - 发布能力接口（草稿箱/发布）

普通订阅号部分功能可能受限。

### 图片生成配置

```env
# 图片生成引擎
IMAGE_ENGINE=stable-diffusion  # 或 dall-e-3

# Stable Diffusion 配置（需要本地部署）
STABLE_DIFFUSION_API_URL=http://localhost:7860
```

**注意**：图片生成是可选的，未配置时系统会跳过图片生成步骤。

---

## 常见问题

### Q1: 提示"未配置微信公众号API"

**A**：请检查 `.env` 文件中是否正确配置了 `WECHAT_APP_ID` 和 `WECHAT_APP_SECRET`

### Q2: API 调用失败，提示 access_token 无效

**A**：
1. 确认 AppID 和 AppSecret 正确
2. 检查 AppSecret 是否已过期或被重置
3. 确认公众号类型是认证服务号

### Q3: 文章发布成功，但在公众号后台看不到

**A**：
- 默认发布为草稿状态
- 需要在公众号后台的"草稿箱"中查看
- 需要手动点击"发布"才能正式发布

### Q4: 生成的文章质量不理想

**A**：
1. 调整 AI 模型：尝试使用更强大的模型
2. 优化主题描述：更详细的主题描述会产生更好的内容
3. 生成预览模式：先预览再决定是否发布
4. 使用不同的 AI 服务：切换到其他 AI 提供商

### Q5: 如何修改文章内容

**A**：
- 文章发布到草稿箱后，可以在公众号后台编辑
- 或者在生成预览模式下，可以取消发布，然后修改主题重新生成

### Q6: 批量发布时部分失败怎么办

**A**：
- 系统会显示每个主题的处理结果
- 失败的主题可以单独重新发布
- 检查失败原因（日志中有详细记录）

---

## 技术说明

### 文件结构

```
project/
├── agents/
│   ├── planner.py              # 策划智能体
│   ├── wechat_writer.py        # 公众号写作智能体
│   ├── designer.py             # 设计智能体
│   ├── reviewer.py             # 审核智能体
│   └── wechat_publisher.py     # 公众号发布智能体
├── wechat_main.py              # 公众号主程序
├── config.py                   # 配置管理
├── logger.py                   # 日志管理
├── .env                        # 配置文件
└── wechat_publish_records/     # 发布记录目录
```

### 日志位置

- 日志文件：`logs/wechat_publisher.log`
- 发布记录：`wechat_publish_records/records_YYYYMMDD.json`

### 数据备份

建议定期备份以下目录：
- `wechat_publish_records/` - 发布记录
- `generated_images/` - 生成的图片
- `logs/` - 运行日志

---

## 高级功能

### 自定义内容策略

可以修改 `agents/planner.py` 来调整内容策略：

```python
# 修改目标人群
target_audience = "您的目标人群"

# 修改内容角度
content_angles = ["角度1", "角度2"]

# 修改写作风格
tone = "您的写作风格"
```

### 自定义文章模板

可以修改 `agents/wechat_writer.py` 来调整文章生成逻辑：

```python
# 修改文章长度
max_tokens=4000  # 调整为更长或更短

# 修改文章结构
# 在 _generate_content 方法中修改 prompt
```

### 定时发布

目前系统支持手动发布。如需定时发布功能，可以：

1. 先生成文章并保存为草稿
2. 在公众号后台设置定时发布
3. 或使用公众号的"定时群发"功能

---

## 更新日志

### v1.0.0 (2026-02-07)

- ✅ 初始版本发布
- ✅ 支持微信公众号文章生成
- ✅ 支持图片生成（可选）
- ✅ 支持批量发布
- ✅ 支持发布记录查询

---

## 技术支持

如遇到问题，请检查：

1. **配置文件**：`.env` 是否正确配置
2. **日志文件**：`logs/wechat_publisher.log` 中的错误信息
3. **API 权限**：公众号是否具有相应权限
4. **网络连接**：确保能访问微信 API 服务器

---

## 免责声明

- 本工具仅供学习和研究使用
- 请遵守微信公众号平台规则
- 使用前请仔细阅读微信公众号开发者协议
- 因使用本工具造成的任何问题，使用者自行承担责任

---

## 开源协议

MIT License
